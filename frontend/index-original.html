<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mazungumzo AI - Mental Health Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .stats-bar {
            background: #f8f9fa;
            padding: 10px 20px;
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
            color: #666;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #4CAF50;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: #007bff;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .message.crisis .message-bubble {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-left: 4px solid #f39c12;
        }

        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .message-input:focus {
            border-color: #4CAF50;
        }

        .send-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .send-button:hover {
            background: #45a049;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 16px;
            color: #666;
            font-style: italic;
        }

        .language-selector {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .language-btn {
            padding: 5px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .language-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .crisis-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .resources {
            margin-top: 10px;
        }

        .resource-item {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .stats-bar {
                font-size: 0.8rem;
                padding: 8px 15px;
            }
        }

        .demo-note {
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ù Mazungumzo AI</h1>
            <p>Your Mental Health Companion ‚Ä¢ Rafiki wa Afya ya Akili</p>
            
            <div class="language-selector">
                <span style="font-size: 0.9rem;">Language:</span>
                <button class="language-btn active" data-lang="en">English</button>
                <button class="language-btn" data-lang="sw">Kiswahili</button>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="activeUsers">0</div>
                <div>Active Users</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalConversations">0</div>
                <div>Conversations</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="resourcesAvailable">0</div>
                <div>Resources</div>
            </div>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="demo-note">
                    <strong>üöÄ Hackathon Demo:</strong> This is a working prototype of Mazungumzo AI, built for the Cerebras + OpenRouter + Qwen3 hackathon. Try asking about mental health support in English or Swahili!
                </div>
                
                <div class="message bot">
                    <div class="message-bubble">
                        Hujambo! Mimi ni Mazungumzo, rafiki yako wa kusaidia katika mambo ya afya ya akili. Naweza kukusaidia kwa lugha ya Kiingereza au Kiswahili. Unahisije leo?<br><br>
                        Hello! I'm Mazungumzo, your mental health companion. I can help you in English or Swahili. How are you feeling today?
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                Mazungumzo is typing...
            </div>

            <div class="crisis-alert" id="crisisAlert">
                <strong>‚ö†Ô∏è Crisis Support Detected</strong>
                <p>Naona unaweza kuhitaji msaada wa haraka. Tafadhali wasiliana na:</p>
                <div class="resources" id="crisisResources"></div>
            </div>

            <div class="input-area">
                <input 
                    type="text" 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Type your message... / Andika ujumbe wako..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application state
        let currentLanguage = 'en';
        let userId = 'demo_user_' + Math.random().toString(36).substr(2, 9);
        let isTyping = false;

        // API configuration
        const API_BASE = 'http://localhost:8000';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            setupLanguageToggle();
        });

        // Language toggle functionality
        function setupLanguageToggle() {
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLanguage = this.dataset.lang;
                });
            });
        }

        // Load and display stats
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const stats = await response.json();
                
                document.getElementById('activeUsers').textContent = stats.active_users;
                document.getElementById('totalConversations').textContent = stats.total_conversations;
                document.getElementById('resourcesAvailable').textContent = stats.resources_available;
            } catch (error) {
                console.log('Stats loading failed:', error);
            }
        }

        // Handle enter key press
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Send message to backend
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;

            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTyping(true);
            
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        message: message,
                        language: currentLanguage,
                        platform: 'web'
                    })
                });

                const data = await response.json();
                
                // Hide typing indicator
                showTyping(false);
                
                // Add bot response
                const messageClass = data.is_crisis ? 'crisis' : 'bot';
                addMessage(data.response, messageClass);
                
                // Show crisis alert if detected
                if (data.is_crisis) {
                    showCrisisAlert(data.resources);
                }
                
                // Update stats
                loadStats();
                
            } catch (error) {
                showTyping(false);
                addMessage('Pole sana, kuna tatizo la kiufundi. Tafadhali jaribu tena. (Sorry, there\'s a technical issue. Please try again.)', 'bot');
                console.error('Chat error:', error);
            }
        }

        // Add message to chat display
        function addMessage(content, type) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${content.replace(/\n/g, '<br>')}
                </div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Show/hide typing indicator
        function showTyping(show) {
            const indicator = document.getElementById('typingIndicator');
            const sendButton = document.getElementById('sendButton');
            
            isTyping = show;
            indicator.style.display = show ? 'block' : 'none';
            sendButton.disabled = show;
            
            if (show) {
                const messagesDiv = document.getElementById('messages');
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }

        // Show crisis alert
        function showCrisisAlert(resources) {
            const alertDiv = document.getElementById('crisisAlert');
            const resourcesDiv = document.getElementById('crisisResources');
            
            if (resources && resources.length > 0) {
                resourcesDiv.innerHTML = '';
                resources.forEach(resource => {
                    const resourceItem = document.createElement('div');
                    resourceItem.className = 'resource-item';
                    resourceItem.textContent = resource;
                    resourcesDiv.appendChild(resourceItem);
                });
                
                alertDiv.style.display = 'block';
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 10000);
            }
        }

        // Demo helper functions for hackathon presentation
        function simulateTyping(text, callback) {
            let index = 0;
            const interval = setInterval(() => {
                if (index < text.length) {
                    // Simulate typing effect
                    index++;
                } else {
                    clearInterval(interval);
                    callback();
                }
            }, 50);
        }

        // Add some demo messages for presentation
        function loadDemoConversation() {
            setTimeout(() => {
                addMessage("Nimehisi vibaya sana wiki hii... (I've been feeling really bad this week...)", 'user');
            }, 2000);
            
            setTimeout(() => {
                showTyping(true);
            }, 3000);
            
            setTimeout(() => {
                showTyping(false);
                addMessage("Pole sana kwa hali yako. Ni muhimu sana kuongea kuhusu hisia zako. Je, unaweza kuniambia ni nini kimekufanya uhisi hivyo? Mimi nipo hapa kukusikiliza bila kuhukumu. (I'm sorry about how you're feeling. It's very important to talk about your feelings. Can you tell me what has made you feel this way? I'm here to listen without judgment.)", 'bot');
            }, 5000);
        }

        // Keyboard shortcuts for demo
        document.addEventListener('keydown', function(event) {
            // Ctrl + D for demo conversation
            if (event.ctrlKey && event.key === 'd') {
                event.preventDefault();
                loadDemoConversation();
            }
            
            // Ctrl + R for reload stats
            if (event.ctrlKey && event.key === 'r') {
                event.preventDefault();
                loadStats();
            }
        });

        // Auto-refresh stats every 30 seconds
        setInterval(loadStats, 30000);

        console.log('ü§ù Mazungumzo AI Demo Loaded');
        console.log('üéØ Hackathon: Cerebras + OpenRouter + Qwen3');
        console.log('üîß Shortcuts: Ctrl+D (demo), Ctrl+R (refresh stats)');
    </script>
</body>
</html>